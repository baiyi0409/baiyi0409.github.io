<template>
  <div class="space-y-24 md:space-y-32 lg:space-y-40 pt-32">
    <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
    <div
      id="float-nav-container"
      class="fixed bottom-0 left-1/2 -translate-x-1/2 md:top-4 md:bottom-auto z-50 transition-opacity duration-300"
    >
      <nav
        class="bg-gradient-to-b from-white to-neutral-100 dark:from-neutral-800 dark:to-neutral-900 border rounded-full shadow-lg px-3 py-2"
      >
        <ul class="flex flex-row items-center space-x-2">
          <li>
            <button
              data-nav-id="top"
              class="nav-button rounded-full text-sm transition-all duration-300 whitespace-nowrap px-3 py-1.5 w-full text-neutral-500 hover:text-primary/80 hover:bg-primary/10 dark:hover:bg-neutral-800"
            >
              è¿”å›é¡¶éƒ¨
            </button>
          </li>
          <li>
            <button
              data-nav-id="feature"
              class="nav-button rounded-full text-sm transition-all duration-300 whitespace-nowrap px-3 py-1.5 w-full text-neutral-500 hover:text-primary/80 hover:bg-primary/10 dark:hover:bg-neutral-800"
            >
              äº†è§£ä¸‹æˆ‘
            </button>
          </li>
          <li>
            <button
              data-nav-id="shorts"
              class="nav-button rounded-full text-sm transition-all duration-300 whitespace-nowrap px-3 py-1.5 w-full text-neutral-500 hover:text-primary/80 hover:bg-primary/10 dark:hover:bg-neutral-800"
            >
              æœ€æ–°åŠ¨æ€
            </button>
          </li>
          <li>
            <button
              data-nav-id="poe"
              class="nav-button rounded-full text-sm transition-all duration-300 whitespace-nowrap px-3 py-1.5 w-full text-neutral-500 hover:text-primary/80 hover:bg-primary/10 dark:hover:bg-neutral-800"
            >
              ä¿¡æ¡
            </button>
          </li>
        </ul>
      </nav>
    </div>
    <!-- heroéƒ¨åˆ† -->
    <div id="hero" class="container mx-auto">
      <section class="w-full max-w-sm mx-auto px-8 sm:px-6">
        <div class="flex flex-col items-center md:items-start gap-6 sm:gap-8">
          <!-- å¤´åƒ -->
          <div class="flex-shrink-0">
            <img
              src="/src/assets/avatar.jpg"
              infersize="true"
              alt="yao"
              width="940"
              height="940"
              loading="lazy"
              decoding="async"
              class="w-28 h-28 sm:w-32 sm:h-32 md:w-36 md:h-36 rounded-full object-cover border-2 border-zinc-200 shadow-sm"
            />
          </div>
          <!-- ä»‹ç» -->
          <div
            class="flex flex-col md:px-4 items-center md:items-start text-center md:text-left w-full"
          >
            <h1
              class="text-2xl sm:text-3xl font-bold mb-3 sm:mb-2 leading-tight"
            >
              {{ hero.name }}
            </h1>
            <div class="mb-6 w-full">
              <p
                class="text-gray-800 dark:text-gray-300 whitespace-pre-wrap text-sm sm:text-base leading-relaxed max-w-prose"
              >
                {{ hero.text }}
              </p>
            </div>
            <a
              class="-ml-1 inline-flex items-center justify-center gap-2 rounded-full px-4 py-2 sm:px-3 sm:py-1 text-sm leading-6 text-black ring-1 ring-zinc-200 bg-white ring-inset hover:bg-zinc-50 active:bg-zinc-100 transition-colors duration-200 touch-manipulation min-h-[44px] sm:min-h-auto"
              target="_blank"
              href=""
            >
              è”ç³»æˆ‘
              <div
                class="h-2 w-2 rounded-full bg-black border-2 border-black"
              ></div>
              <div class="h-2 w-2 rounded-full border-black border-2"></div>
            </a>
            <!-- {socials && (
				<div class="flex flex-wrap gap-2 mt-3 justify-center md:justify-start">
					{socials.map((social: any) => (
						<a
							class="inline-flex items-center justify-center gap-2 rounded-full px-3 py-2 sm:px-3 sm:py-1 text-sm leading-6 text-black ring-1 ring-zinc-200 bg-white ring-inset hover:bg-zinc-50 active:bg-zinc-100 transition-colors duration-200 touch-manipulation min-h-[44px] sm:min-h-auto"
							target="_blank"
							href={social.url}
						>
							{social.type}
						</a>
					))}
				</div>
			)} -->
          </div>
        </div>
      </section>
    </div>

    <!-- featureéƒ¨åˆ† -->
    <div id="feature">
      <MaskText :title="feature.text" :description="feature.description" />
    </div>

    <!-- shortéƒ¨åˆ† -->
    <div id="shorts" class="container max-w-6xl mx-auto">
      <MaskText :title="shorts.text" :description="shorts.description" />
    </div>

    <!-- poeéƒ¨åˆ† -->
    <div id="poe">
      <Poe/>
    </div>
  </div>


</template>

<script setup lang="ts">
import { onMounted, onUnmounted, ref , reactive} from "vue";
import MaskText from './MaskText.vue';
import Poe from './Poe.vue';

//heroä»‹ç»
const hero = reactive({
  name: `yao`,
  text: `00 åå°é•‡ç¨‹åºå‘˜
.Net åº”ç”¨å¼€å‘è€…ï¼ŒåŠä¸ªå…¨æ ˆå·¥ç¨‹å¸ˆ

å¾’æ­¥çˆ±å¥½è€…ğŸ”`
})

//featureéƒ¨åˆ†
const feature = reactive({
  text:`ç®€å•äº†è§£ä¸€ä¸‹æˆ‘
é—¯è¡ã€å‹‡æ•¢å°è¯•ã€ä¸æ”¾å¼ƒ`,
  description:`You know, my mother used to say that risk-takers defy destine.`
})

//shortséƒ¨åˆ†
const shorts = reactive({
  text:`æ¬²ä¹°æ¡‚èŠ±åŒè½½é…’
ç»ˆä¸ä¼¼ï¼Œå°‘å¹´æ¸¸`,
  description:`The wind never stops blowing we just forget how to run.`
})


// å¯¼èˆªé…ç½®
const navItems = [
  { id: "top", label: "è¿”å›é¡¶éƒ¨", offset: 0 },
  { id: "feature", label: "äº†è§£ä¸‹æˆ‘", offset: -80 },
  { id: "shorts", label: "æœ€æ–°åŠ¨æ€", offset: -80 },
  { id: "poe", label: "ä¿¡æ¡", offset: -80 },
];

// å“åº”å¼ï¼šå½“å‰æ¿€æ´»åŒºå—
const activeSectionId = ref("top");

// å¹³æ»‘æ»šåŠ¨å‡½æ•°
const scrollToSection = (id: string, offset: number = 0) => {
  if (id === "top") {
    window.scrollTo({ top: 0, behavior: "smooth" });
    return;
  }

  const element = document.getElementById(id);
  if (element) {
    const top = element.offsetTop + offset;
    window.scrollTo({ top, behavior: "smooth" });
  }
};

// æ›´æ–°å¯¼èˆªæŒ‰é’®æ ·å¼
const updateNavButtonClasses = () => {
  const buttons = document.querySelectorAll(".nav-button");
  buttons.forEach((button) => {
    const buttonId = button.getAttribute("data-nav-id");
    if (buttonId === activeSectionId.value) {
      button.classList.add("!text-primary", "font-bold");
    } else {
      button.classList.remove("!text-primary", "font-bold");
    }
  });
};

// æ»šåŠ¨ç›‘å¬å‡½æ•°ï¼ˆå¸¦èŠ‚æµï¼‰
let throttleTimer: number | null = null;
const onScroll = () => {
  if (throttleTimer) return;
  throttleTimer = window.setTimeout(() => {
    throttleTimer = null;

    const scrollPosition = window.scrollY + 100; // å¢åŠ 100pxç¼“å†²ï¼Œæ›´æ—©æ¿€æ´»
    let currentActiveId = "top";

    for (const item of navItems) {
      if (item.id === "top") continue;

      const element = document.getElementById(item.id);
      if (!element) continue;

      const sectionTop = element.offsetTop + (item.offset || 0);
      const sectionBottom = sectionTop + element.offsetHeight;

      if (scrollPosition >= sectionTop && scrollPosition < sectionBottom) {
        currentActiveId = item.id;
        break;
      }
    }

    if (activeSectionId.value !== currentActiveId) {
      activeSectionId.value = currentActiveId;
      updateNavButtonClasses();
    }
  }, 100); // èŠ‚æµ100ms
};

// åˆå§‹åŒ–å¯¼èˆª
const initializeNavigation = () => {
  const buttons = document.querySelectorAll(".nav-button");
  buttons.forEach((button) => {
    const id = button.getAttribute("data-nav-id");
    if (id) {
      button.addEventListener("click", () => {
        const item = navItems.find((nav) => nav.id === id);
        if (item) scrollToSection(item.id, item.offset);
      });
    }
  });

  window.addEventListener("scroll", onScroll);
  onScroll(); // åˆå§‹åŒ–æ—¶æ‰§è¡Œä¸€æ¬¡
};

// ç»„ä»¶æŒ‚è½½ & å¸è½½
onMounted(() => {
  initializeNavigation();
});

onUnmounted(() => {
  window.removeEventListener("scroll", onScroll);
});

</script>

<style scoped>
.whitespace-pre-wrap {
  white-space: pre-wrap;
}
.relative {
  position: relative;
}
.whitespace-pre-line {
  white-space: pre-line;
}

</style>